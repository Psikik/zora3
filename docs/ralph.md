# Ralph: Autonomous AI Coding Agent

Reference guide synthesized from the [Ralph Playbook](https://claytonfarr.github.io/ralph-playbook/)
and [Geoff Huntley's original post](https://ghuntley.com/ralph/).

## How Ralph Works

Ralph is a looping technique where Claude Code runs continuously in a bash loop. Each iteration
reads instructions, picks one task from a plan, implements it, commits, and exits. The loop
restarts with a fresh context window.

Each iteration follows this cycle:

1. **Orient** — Study specs, source code, and current plan
2. **Select** — Pick the most important task from the plan
3. **Investigate** — Search the codebase before changing anything
4. **Implement** — Write the code completely (no stubs or placeholders)
5. **Validate** — Run tests, typecheck, lint (backpressure)
6. **Update** — Mark task done in plan, update AGENTS.md if needed
7. **Commit & push** — The loop restarts with a fresh context

## File Structure

```
project-root/
├── loop.sh                    # Bash loop with mode selection
├── PROMPT_build.md            # Build mode instructions
├── PROMPT_plan.md             # Plan mode instructions
├── AGENTS.md                  # Operational guide (build cmds, patterns — <80 lines)
├── IMPLEMENTATION_PLAN.md     # Prioritized task list (generated, disposable)
├── specs/                     # Requirement specs (one per topic)
├── Dockerfile                 # Sandbox container image (generated by setup.sh)
├── compose.yml                # Runs the agent container
└── src/                       # Application source code
```

## Steering Ralph

**Upstream (deterministic setup):**
- Specs define what to build
- AGENTS.md defines how (build commands, patterns)
- Prompts define the loop behavior
- Existing code patterns shape what Ralph generates

**Downstream (backpressure):**
- Tests, typechecks, lints reject invalid work
- AGENTS.md specifies the actual validation commands
- `--max-turns` limits round-trips per iteration
- Iteration count limits total sessions

## Common Operations

```bash
podman compose run ralph plan 1   # One planning pass
podman compose run ralph 1        # One build iteration
podman compose run ralph          # Unlimited build
podman compose run ralph plan     # Unlimited planning
```

Review Ralph's work: `git log`, diff against plan, check test output.

## Key Files

**AGENTS.md** — Operational guide loaded every iteration. Contains build commands,
validation commands, and codebase patterns. Keep it under 80 lines. Status updates
and progress notes belong in IMPLEMENTATION_PLAN.md — a bloated AGENTS.md pollutes
every future loop's context.

**IMPLEMENTATION_PLAN.md** — Prioritized task list. Created during planning mode,
updated during building mode. Disposable — regenerate anytime by running planning mode.

**specs/** — One markdown file per topic. Source of truth for what should be built.

## Pitfalls

- No cleanup between iterations — dirty state persists if Ralph dies mid-file
- No exit condition in build prompt — Ralph keeps going until context fills
- AGENTS.md must stay short (<80 lines) or it wastes context budget
- Fix the spec first if Ralph builds the wrong thing — don't fight the loop
- Ralph may rewrite existing code if not told to search first — the "don't assume
  not implemented" guardrail in the build prompt prevents this

## Subagent Architecture

| Type | Count | Use |
|------|-------|-----|
| Sonnet subagents | Up to 500 parallel | Searches, reads, codebase exploration |
| Sonnet subagents | Only 1 | Build/tests (serialize validation) |
| Opus subagents | As needed | Complex reasoning, debugging, architecture |

## Security

`--dangerously-skip-permissions` bypasses ALL permission prompts. **Always run in a
sandbox (container).** Never run this on your host machine.

## Tuning Approach

Start with almost nothing in AGENTS.md. Watch initial loops. See where gaps occur.
Tune behavior reactively via AGENTS.md updates and code patterns. Observe-and-adjust,
not prescribe upfront.
